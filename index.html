<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chatbot Karya Siswa</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #f0f0f0; }
    #chat { max-width: 600px; margin: auto; background: #fff; padding: 15px; border-radius: 8px; }
    .msg { margin: 10px 0; }
    .user { text-align: right; color: blue; }
    .bot { text-align: left; color: green; }
    input[type=text] { width: 100%; padding: 10px; box-sizing: border-box; }
  </style>
</head>
<body>
  <div id="chat">
    <div class="msg bot">ü§ñ Bot: Halo, tanya tentang karya siswa!</div>
  </div>
  <input type="text" id="inp" placeholder="Ketik judul atau nama..." />

  <script>
    const appUrl = "https://script.google.com/macros/s/AKfycbwJGVdOje7xKo9Sp6nO0roUxyknW_0pZsGAVbTszVsG2gzIBd2hIf06aui0Zt0ppGwvQQ/exec";
    let sheetData = [];

    fetch(appUrl)
      .then(res => res.json())
      .then(data => { sheetData = data; })
      .catch(err => console.error("Fetch error", err));

    document.getElementById("inp").addEventListener("keypress", function(e) {
      if (e.key === "Enter") {
        const v = e.target.value.trim().toLowerCase();
        if (!v) return;
        addMsg(e.target.value, "user");
        setTimeout(() => replyLocal(v), 500);
        e.target.value = "";
      }
    });

    function replyLocal(q) {
      const found = sheetData.find(r =>
        r["Nama Siswa"]?.toLowerCase().includes(q) ||
        r["Judul Karya"]?.toLowerCase().includes(q)
      );
      if (found) {
        addMsg(
          `Karya: "${found["Judul Karya"]}" oleh ${found["Nama Siswa"]}, kelas ${found["Kelas"]}. Deskripsi: ${found["Deskripsi"]}`,
          "bot"
        );
      } else {
        addMsg("ü§ñ Bot: Maaf, saya tidak menemukan karya tersebut.", "bot");
      }
    }

    function addMsg(text, cls) {
      const d = document.createElement("div");
      d.className = `msg ${cls}`;
      d.innerHTML = (cls==="user"?"üë©‚Äçüè´ Anda":"ü§ñ Bot") + ": " + text;
      document.getElementById("chat").appendChild(d);
      window.scrollTo(0, document.body.scrollHeight);
    }
  </script>
</body>
</html>
